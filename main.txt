from tren import Tren
import random
import time

def algoritmo_tren(tren: Tren):
    """
    Docstring para algoritmo_tren
    
    :param tren: DescripciÃ³n
    :type tren: Tren

    Funcionamiento:
        - Empezamos en la posicion 0. Dejamos la luz como esta
        - Cambiamos la luz a lo contrario del resto de vagones recorriendo el array
        - Cuando llegamos a un vagon_n que tiene la luz como el vagon_0, contamos si hay despues de el n vagones con la luz contraria
        - Si los hay, hemos terminado y hay n vagones
    """

    luz_inicial = tren.get_vagon(0).luz

    pos_vagon_actual = 1
    pos_vagon_estudiado = -1
    n_vagones_luz_contraria = 0

    while(True):

        #time.sleep(0.01)

        vagon_actual = tren.get_vagon(pos_vagon_actual)

        #print(f"luz inicial: {luz_inicial}, luz_actual: {vagon_actual.luz}, Iteracion: {pos_vagon_actual}, vagon_actual_real: {pos_vagon_actual % tren.n_vagones}, Estudiando vagon: {pos_vagon_estudiado}, N_vagones_luz_contraira: {n_vagones_luz_contraria}")


        if vagon_actual.luz == luz_inicial:

            vagon_actual.luz = not luz_inicial #Luz contraria
            n_vagones_luz_contraria = 0
            pos_vagon_estudiado = pos_vagon_actual
        else:
            n_vagones_luz_contraria += 1


        pos_vagon_actual += 1

        #if pos_vagon_estudiado >=9: #min vagones
        if n_vagones_luz_contraria == (pos_vagon_estudiado - 1):
            return pos_vagon_estudiado


def main():
    """
    n_predicciones_correctas = 0

    for i in range(0, 100):
        mi_tren = Tren(random.randint(9, 15))
        n_vagones = algoritmo_tren(mi_tren)

        if n_vagones == mi_tren.n_vagones:
            n_predicciones_correctas+=1
        else:
            print(mi_tren)
            print(f"Prediccion: {n_vagones}")

    print(f"De 99 simulaciones, {n_predicciones_correctas}  predicciones correctas")
    """

    mi_tren = Tren(random.randint(9, 100))
    n_vagones = algoritmo_tren(mi_tren)
    print(f"n_vagones: {mi_tren.n_vagones}, n_vagones predecidos: {n_vagones}")

if __name__ == "__main__":
    main()